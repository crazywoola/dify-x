<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>从 Low-Code 到 Pro-Code · 程序员如何驾驭 Dify 进行 LLM 应用开发</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/theme/white.css" id="theme">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/plugin/highlight/github.css">

    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&family=Noto+Sans+Mono:wght@400;500&family=Fira+Code&display=swap"
        rel="stylesheet">

    <script src="shared.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="shared.css">
</head>

<body>

    <div class="lang-switch">
        <a class="active" href="index.html">中文</a>
        <span>/</span>
        <a href="index_en.html">EN</a>
    </div>

    <div id="bg-shapes" aria-hidden="true">
        <div class="shape s1"></div>
        <div class="shape s2"></div>
        <div class="shape s3"></div>
    </div>

    <div class="absolute top-10 left-10 font-bold text-2xl z-10" style="font-family: var(--font-stack);">
        D<span class="text-dify">if</span>y
    </div>

    <div class="fixed bottom-5 right-5 text-xs text-dify opacity-50">按键盘 ↓ 查看详情</div>

    <div class="reveal">
        <div class="slides">

            <!-- Section 0: Title Slide -->
            <section>
                <div style="text-align: left; max-width: 80%;">
                    <h1>从 Low-Code 到 Pro-Code</h1>
                    <h3 style="font-weight: 600; margin-top: 10px;">程序员如何驾驭 Dify 进行 LLM 应用开发</h3>
                    <p class="text-text-secondary" style="font-size: 0.9em; margin-top: 30px; line-height: 1.6;">
                        Dify x PUPU · 开源、可观测、可扩展的智能工作流与插件生态。
                    </p>
                    <div style="margin-top: 26px; font-size: 0.9em; font-weight: 600; color: var(--text-secondary);">
                        郑立 · Dify 开源生态负责人
                    </div>
                    <div style="margin-top: 60px;">
                        <span style="font-size: 0.6em; color: #9ca3af;">2025 / Sharing Deck</span>
                    </div>
                </div>
            </section>

            <!-- Section: Outline (Updated) -->
            <section>
                <div class="text-left max-w-[1000px]">
                    <h2>Agenda</h2>
                    <div class="grid grid-cols-2 gap-x-[60px] gap-y-10 mt-10">
                        <div class="flex items-start gap-5 pb-5 border-b border-black/5">
                            <span class="text-[1.2em] leading-none">🚀</span>
                            <div>
                                <strong class="block text-base mb-1.5 text-[var(--text-main)]">范式破局</strong>
                                <p class="text-xs text-text-secondary m-0 leading-[1.4]">LLM 应用开发的下一代标准与 Dify 定位。</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-5 pb-5 border-b border-black/5">
                            <span class="text-[1.2em] leading-none">🤝</span>
                            <div>
                                <strong class="block text-base mb-1.5 text-[var(--text-main)]">高低融合</strong>
                                <p class="text-xs text-text-secondary m-0 leading-[1.4]">Visual DSL 与 Pro-Code 的辩证统一。
                                </p>
                            </div>
                        </div>
                        <div class="flex items-start gap-5 pb-5 border-b border-black/5">
                            <span class="text-[1.2em] leading-none">🧰</span>
                            <div>
                                <strong class="block text-base mb-1.5 text-[var(--text-main)]">生态扩展</strong>
                                <p class="text-xs text-text-secondary m-0 leading-[1.4]">Marketplace、Plugins 与工具链构建。</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-5 pb-5 border-b border-black/5">
                            <span class="text-[1.2em] leading-none">⚡</span>
                            <div>
                                <strong class="block text-base mb-1.5 text-[var(--text-main)]">事件驱动</strong>
                                <p class="text-xs text-text-secondary m-0 leading-[1.4]">Trigger 机制实现的自动化闭环。</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-5 pb-5 border-b border-black/5">
                            <span class="text-[1.2em] leading-none">📊</span>
                            <div>
                                <strong class="block text-base mb-1.5 text-[var(--text-main)]">全景洞察</strong>
                                <p class="text-xs text-text-secondary m-0 leading-[1.4]">OpenTelemetry 全链路追踪与多库适配。</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-5 pb-5 border-b border-black/5">
                            <span class="text-[1.2em] leading-none">🎯</span>
                            <div>
                                <strong class="block text-base mb-1.5 text-[var(--text-main)]">未来展望</strong>
                                <p class="text-xs text-text-secondary m-0 leading-[1.4]">总结与 Call for Action。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 1: 破局 -->
            <section>
                <section data-background-color="#f9fafb">
                    <div class="slide-hero">
                        <h2>破局 · 下一代 LLM 应用开发范式</h2>
                        <p>从痛点切入，思考 Dify 的技术定位。</p>
                        <img src="assets/Paradigm+Shift+Illustration.png" alt="范式转移示意图"
                            class="slide-visual shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5">
                    </div>
                </section>

                <section>
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h2>Community-Driven <span class="text-dify">·</span> 全球认可</h2>
                        <p class="text-text-secondary text-[0.8em]">开源生态驱动，Top 100 GitHub 仓库。</p>
                        <div class="grid grid-cols-3 gap-6">
                            <div class="border-l-4 border-dify pl-4">
                                <span
                                    class="text-[0.5em] uppercase tracking-[1px] text-text-secondary font-semibold block mb-1 flex items-center gap-1"><i
                                        class="ri-install-line"></i> Install</span>
                                <span class="text-[1.6em] font-bold leading-none mb-1 block">1M+</span>
                                <span class="text-[0.6em] text-text-secondary">Powered by Dify</span>
                            </div>
                            <div class="border-l-4 border-dify pl-4">
                                <span
                                    class="text-[0.5em] uppercase tracking-[1px] text-text-secondary font-semibold block mb-1 flex items-center gap-1"><i
                                        class="ri-star-line"></i> Popularity</span>
                                <span class="text-[1.6em] font-bold leading-none mb-1 block">120K+</span>
                                <span class="text-[0.6em] text-text-secondary">GitHub Stars</span>
                            </div>
                            <div class="border-l-4 border-dify pl-4">
                                <span
                                    class="text-[0.5em] uppercase tracking-[1px] text-text-secondary font-semibold block mb-1 flex items-center gap-1"><i
                                        class="ri-global-line"></i> Global Reach</span>
                                <span class="text-[1.6em] font-bold leading-none mb-1 block">150+</span>
                                <span class="text-[0.6em] text-text-secondary">Countries</span>
                            </div>
                            <div class="border-l-4 border-dify pl-4">
                                <span
                                    class="text-[0.5em] uppercase tracking-[1px] text-text-secondary font-semibold block mb-1 flex items-center gap-1"><i
                                        class="ri-building-4-line"></i> Enterprise</span>
                                <span class="text-[1.6em] font-bold leading-none mb-1 block">60+</span>
                                <span class="text-[0.6em] text-text-secondary">Industries</span>
                            </div>
                            <div class="border-l-4 border-dify pl-4">
                                <span
                                    class="text-[0.5em] uppercase tracking-[1px] text-text-secondary font-semibold block mb-1 flex items-center gap-1"><i
                                        class="ri-team-line"></i> Contributors</span>
                                <span class="text-[1.6em] font-bold leading-none mb-1 block">1000+</span>
                                <span class="text-[0.6em] text-text-secondary">Contributors</span>
                            </div>
                            <div class="border-l-4 border-dify pl-4">
                                <span
                                    class="text-[0.5em] uppercase tracking-[1px] text-text-secondary font-semibold block mb-1 flex items-center gap-1"><i
                                        class="ri-download-2-line"></i> Downloads</span>
                                <span class="text-[1.6em] font-bold leading-none mb-1 block">550M+</span>
                                <span class="text-[0.6em] text-text-secondary">Total downloads</span>
                            </div>
                        </div>
                    </div>
                </section>

                <section>
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h3>1.0 案例演示：RAG + 规则双轨</h3>
                        <p class="text-text-secondary text-[0.85em]">30 分钟搭建：数据预处理 → 检索 → Guardrail → 结果回传。</p>
                        <div class="grid grid-cols-3 gap-5">
                            <div class="bg-white/90 rounded-xl border border-black/5 p-5 shadow-sm glow-card">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-semibold text-text-secondary">数据预处理</span>
                                    <span class="text-xs text-dify bg-dify-light px-2 py-1 rounded-full">10 min</span>
                                </div>
                                <p class="text-[0.75em] text-text-secondary mt-2">批量清洗 + 分段，输出向量入库。</p>
                                <code class="text-[0.65em] block bg-slate-900 text-slate-100 rounded p-3 mt-3"># python node\nchunks = split(doc, size=400)\nstore(chunks)</code>
                            </div>
                            <div class="bg-white/90 rounded-xl border border-black/5 p-5 shadow-sm glow-card">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-semibold text-text-secondary">检索 + Guardrail</span>
                                    <span class="text-xs text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full">14 ms</span>
                                </div>
                                <p class="text-[0.75em] text-text-secondary mt-2">Top-k 检索 + 违规语料过滤，保障安全。</p>
                                <div class="ticker-line text-[0.7em] text-dify font-semibold mt-3">RAG → LLM → 正则/黑名单 → 结果</div>
                            </div>
                            <div class="bg-white/90 rounded-xl border border-black/5 p-5 shadow-sm glow-card">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-semibold text-text-secondary">回传 & 观测</span>
                                    <span class="text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded-full">可回放</span>
                                </div>
                                <p class="text-[0.75em] text-text-secondary mt-2">写回业务表，Trace ID 关联到 APM & Log。</p>
                                <div class="text-[0.7em] text-text-secondary mt-3 space-y-1">
                                    <div class="flex items-center gap-2"><span class="text-dify">●</span> Trace: workflow.run</div>
                                    <div class="flex items-center gap-2"><span class="text-dify">●</span> Token: 115 / req</div>
                                    <div class="flex items-center gap-2"><span class="text-dify">●</span> Cost: $0.0017</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h3>1.0 数据流动画 · 从 Chaos 到 Clarity</h3>
                        <div class="grid grid-cols-3 gap-5 items-center">
                            <div class="bg-white rounded-xl border border-black/5 p-5 shadow-sm">
                                <div class="text-sm font-semibold text-text-secondary mb-2">输入</div>
                                <ul class="text-text-secondary text-[0.75em] space-y-1">
                                    <li>原始日志 / 文档流</li>
                                    <li>实时事件 Payload</li>
                                    <li>自定义特征 (country, ua...)</li>
                                </ul>
                            </div>
                            <div class="flex flex-col gap-4">
                                <div class="h-16 bg-gradient-to-r from-slate-100 to-slate-200 rounded-xl border border-black/5 flex items-center px-4 ticker-line">
                                    <span class="text-text-secondary text-sm">Normalize → Vectorize → Route</span>
                                </div>
                                <div class="h-16 bg-gradient-to-r from-emerald-50 to-emerald-100 rounded-xl border border-black/5 flex items-center px-4 animate-pulse">
                                    <span class="text-emerald-700 text-sm">Guardrail + Policy Check</span>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-black/5 p-5 shadow-sm">
                                <div class="text-sm font-semibold text-text-secondary mb-2">输出</div>
                                <ul class="text-text-secondary text-[0.75em] space-y-1">
                                    <li>响应体 / 回调</li>
                                    <li>指标：p99, token, 成本</li>
                                    <li>Trace 链路：APM & Log</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <section>
                    <div class="flex h-full items-center gap-[60px]">
                        <div class="flex-1 text-left">
                            <h3>1.1 现状痛点</h3>
                            <ul class="text-secondary text-[0.8em] leading-[1.6] space-y-2.5">
                                <li>模型接口碎片化：调用、计费、监控各自为政。</li>
                                <li>迭代周期慢：Prompt/Workflow 更新缺少环境隔离与灰度。</li>
                                <li>团队协作难：缺少统一资产库、复用与可观测手段。</li>
                                <li>生产级要求：审计、指标、重试、配额等“工程化缺口”。</li>
                            </ul>
                        </div>
                        <div class="flex-1 text-left">
                            <img src="assets/Legacy+LLM+Stack+Pain+Points.png" alt="痛点示意图"
                                class="shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5 max-w-[520px] w-full mx-auto">
                        </div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="flex h-full items-center gap-[60px]">
                        <div class="flex-1 text-left">
                            <h3>1.2 Dify 的技术定位</h3>
                            <p class="text-text-secondary text-[0.8em]">一站式 LLM 应用平台：从构建、编排到运行。</p>
                            <div class="grid grid-cols-2 gap-4 mt-2.5 text-left">
                                <div
                                    class="bg-bg-card p-6 rounded-lg transition-transform duration-200 hover:-translate-y-1 text-left">
                                    <i class="ri-flow-chart text-[1.5em] text-dify mb-3 block"></i>
                                    <h4 class="text-sm mb-2">编排</h4>
                                    <p class="text-xs text-text-secondary leading-[1.5] m-0">Workflow / Prompt Studio /
                                        RAG 管道。</p>
                                </div>
                                <div
                                    class="bg-bg-card p-6 rounded-lg transition-transform duration-200 hover:-translate-y-1 text-left">
                                    <i class="ri-shield-check-line text-[1.5em] text-dify mb-3 block"></i>
                                    <h4 class="text-sm mb-2">工程化</h4>
                                    <p class="text-xs text-text-secondary leading-[1.5] m-0">重试、分支、配额、环境隔离。</p>
                                </div>
                                <div
                                    class="bg-bg-card p-6 rounded-lg transition-transform duration-200 hover:-translate-y-1 text-left">
                                    <i class="ri-plug-line text-[1.5em] text-dify mb-3 block"></i>
                                    <h4 class="text-sm mb-2">扩展</h4>
                                    <p class="text-xs text-text-secondary leading-[1.5] m-0">Plugin &
                                        Tooling，开放能力对接外部系统。</p>
                                </div>
                                <div
                                    class="bg-bg-card p-6 rounded-lg transition-transform duration-200 hover:-translate-y-1 text-left">
                                    <i class="ri-bar-chart-2-line text-[1.5em] text-dify mb-3 block"></i>
                                    <h4 class="text-sm mb-2">可观测</h4>
                                    <p class="text-xs text-text-secondary leading-[1.5] m-0">Tracing / Token /
                                        成本可视，保障生产稳定。</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1 text-left">
                            <img src="assets/Dify+Platform+Positioning.png" alt="Dify 定位图"
                                class="shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5 max-w-[520px] w-full mx-auto">
                        </div>
                    </div>
                </section>

                <!-- New Section 1.3: Why Now? -->
                <section>
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>1.3 为什么是现在？</h3>
                        <p class="text-text-secondary text-[0.8em] mb-10">技术临界点已至：算力、模型与数据三大要素齐备。</p>
                        
                        <div class="relative py-10">
                            <!-- Timeline line -->
                            <div class="absolute left-0 right-0 top-1/2 h-1 bg-gradient-to-r from-gray-200 via-dify to-gray-200 transform -translate-y-1/2 z-0"></div>
                            
                            <div class="grid grid-cols-4 gap-4 relative z-10">
                                <div class="bg-white p-4 rounded-xl border border-black/5 shadow-sm text-center">
                                    <div class="text-dify font-bold text-xl mb-1">2017</div>
                                    <div class="text-xs font-semibold">Transformer</div>
                                    <div class="text-[0.6em] text-text-secondary mt-1">Attention is all you need</div>
                                </div>
                                <div class="bg-white p-4 rounded-xl border border-black/5 shadow-sm text-center">
                                    <div class="text-dify font-bold text-xl mb-1">2020</div>
                                    <div class="text-xs font-semibold">GPT-3</div>
                                    <div class="text-[0.6em] text-text-secondary mt-1">Few-shot learning 涌现</div>
                                </div>
                                <div class="bg-white p-4 rounded-xl border border-black/5 shadow-sm text-center transform scale-110 border-dify ring-2 ring-dify/20">
                                    <div class="text-dify font-bold text-xl mb-1">2023</div>
                                    <div class="text-xs font-semibold">Dify v1.0</div>
                                    <div class="text-[0.6em] text-text-secondary mt-1">LLM 应用中间件诞生</div>
                                </div>
                                <div class="bg-white p-4 rounded-xl border border-black/5 shadow-sm text-center">
                                    <div class="text-dify font-bold text-xl mb-1">2024+</div>
                                    <div class="text-xs font-semibold">Pro-Code</div>
                                    <div class="text-[0.6em] text-text-secondary mt-1">工程化、生产级、标准化</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Section 1.4: Traditional vs LLM -->
                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>1.4 传统开发 vs LLM 原生开发</h3>
                        <p class="text-text-secondary text-[0.8em] mb-8">从确定性编程向概率性工程的思维转变。</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="bg-slate-50 p-6 rounded-xl border border-slate-200">
                                <div class="flex items-center gap-2 mb-4">
                                    <i class="ri-code-s-slash-line text-xl text-slate-500"></i>
                                    <strong class="text-lg text-slate-700">传统软件开发</strong>
                                </div>
                                <ul class="space-y-4 text-[0.75em] text-slate-600">
                                    <li class="flex items-start gap-3">
                                        <span class="bg-slate-200 text-slate-600 px-2 py-0.5 rounded text-[0.9em] whitespace-nowrap">核心逻辑</span>
                                        <span>确定性 (Deterministic)<br>If-Then-Else 严密控制</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="bg-slate-200 text-slate-600 px-2 py-0.5 rounded text-[0.9em] whitespace-nowrap">数据处理</span>
                                        <span>结构化 (SQL/JSON)<br>Schema 定义先行</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="bg-slate-200 text-slate-600 px-2 py-0.5 rounded text-[0.9em] whitespace-nowrap">测试方法</span>
                                        <span>单元测试 (Pass/Fail)<br>逻辑覆盖率</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="bg-blue-50 p-6 rounded-xl border border-blue-200 relative overflow-hidden">
                                <div class="absolute top-0 right-0 bg-dify text-white text-[0.6em] px-2 py-1 rounded-bl-lg">Next Gen</div>
                                <div class="flex items-center gap-2 mb-4">
                                    <i class="ri-magic-line text-xl text-dify"></i>
                                    <strong class="text-lg text-dify">LLM 原生开发</strong>
                                </div>
                                <ul class="space-y-4 text-[0.75em] text-blue-800">
                                    <li class="flex items-start gap-3">
                                        <span class="bg-blue-200 text-dify px-2 py-0.5 rounded text-[0.9em] whitespace-nowrap">核心逻辑</span>
                                        <span>概率性 (Probabilistic)<br>Prompt + Context 引导</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="bg-blue-200 text-dify px-2 py-0.5 rounded text-[0.9em] whitespace-nowrap">数据处理</span>
                                        <span>非结构化 (Embedding)<br>语义检索与理解</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="bg-blue-200 text-dify px-2 py-0.5 rounded text-[0.9em] whitespace-nowrap">测试方法</span>
                                        <span>评估 (Eval)<br>准确率、幻觉率、相关性</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Section 1.5: Ecosystem Map -->
                <section>
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>1.5 Dify 生态全景</h3>
                        <p class="text-text-secondary text-[0.8em] mb-6">作为 LLM 应用开发的“操作系统”，链接模型与业务。</p>
                        
                        <div class="flex flex-col gap-4 items-center justify-center p-6 bg-white rounded-xl border border-black/5 shadow-sm">
                            <!-- Top Layer: Users -->
                            <div class="flex gap-4 w-full justify-center">
                                <div class="bg-slate-100 px-6 py-2 rounded-lg text-xs text-text-secondary">End Users</div>
                                <div class="bg-slate-100 px-6 py-2 rounded-lg text-xs text-text-secondary">External Systems</div>
                            </div>
                            
                            <!-- Arrow -->
                            <i class="ri-arrow-down-line text-slate-300"></i>
                            
                            <!-- App Layer -->
                            <div class="grid grid-cols-3 gap-2 w-3/4">
                                <div class="bg-blue-50 border border-blue-100 p-3 rounded-lg text-center text-[0.7em] text-dify">Chat Bots</div>
                                <div class="bg-blue-50 border border-blue-100 p-3 rounded-lg text-center text-[0.7em] text-dify">Agent Assistants</div>
                                <div class="bg-blue-50 border border-blue-100 p-3 rounded-lg text-center text-[0.7em] text-dify">Workflow Automation</div>
                            </div>
                            
                            <!-- Dify Core Layer -->
                            <div class="bg-dify text-white w-full p-4 rounded-xl text-center shadow-lg my-2 relative overflow-hidden">
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-[sweep_3s_linear_infinite]"></div>
                                <div class="font-bold text-lg mb-2">Dify Core Engine</div>
                                <div class="grid grid-cols-4 gap-2 text-[0.6em] text-blue-100">
                                    <div class="bg-white/20 p-2 rounded">Orchestration</div>
                                    <div class="bg-white/20 p-2 rounded">RAG Pipeline</div>
                                    <div class="bg-white/20 p-2 rounded">Plugin Runtime</div>
                                    <div class="bg-white/20 p-2 rounded">Observability</div>
                                </div>
                            </div>
                            
                            <!-- Bottom Layer: Models & Infra -->
                            <div class="grid grid-cols-3 gap-4 w-full text-center">
                                <div class="bg-gray-50 border border-gray-200 p-3 rounded-lg">
                                    <div class="text-[0.6em] font-semibold text-gray-500 mb-1">LLMs</div>
                                    <div class="flex gap-1 justify-center text-[1.2em] text-gray-400">
                                        <i class="ri-openai-fill"></i> <i class="ri-google-fill"></i>
                                    </div>
                                </div>
                                <div class="bg-gray-50 border border-gray-200 p-3 rounded-lg">
                                    <div class="text-[0.6em] font-semibold text-gray-500 mb-1">Vector DBs</div>
                                    <div class="flex gap-1 justify-center text-[1.2em] text-gray-400">
                                        <i class="ri-database-2-fill"></i> <i class="ri-server-fill"></i>
                                    </div>
                                </div>
                                <div class="bg-gray-50 border border-gray-200 p-3 rounded-lg">
                                    <div class="text-[0.6em] font-semibold text-gray-500 mb-1">Compute</div>
                                    <div class="flex gap-1 justify-center text-[1.2em] text-gray-400">
                                        <i class="ri-cpu-line"></i> <i class="ri-cloud-line"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Section 2: 融合 -->
            <section>
                <section data-background-color="#f9fafb">
                    <div class="slide-hero">
                        <h2>融合 · 打破“低代码”的刻板印象</h2>
                        <p>不仅是降低门槛，更是高阶工程能力的“可视化映射”。</p>
                        <img src="assets/Visual+DSL&Observability.png" alt="可视化DSL与可观测性示意图"
                            class="slide-visual shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5">
                    </div>
                </section>

                <section>
                    <div class="flex h-full items-center gap-[60px]">
                        <div class="flex-1 text-left">
                            <h3>2.1 可视化的辩证统一</h3>
                            <p class="text-text-secondary text-[0.7em] mb-5">
                                高低代码都离不开可视化，但核心目的不同：
                            </p>
                            <ul class="list-none m-0 p-0 space-y-[15px] text-[0.8em]">
                                <li class="flex items-start">
                                    <i class="ri-code-s-slash-line text-dify mr-2.5 mt-[2px]"></i>
                                    <div>
                                        <strong>Low-Code 视角：可视化 = 编程语言</strong>
                                        <div class="text-[#6b7280] text-[0.9em] mt-1">降低认知负荷，让逻辑可解释、可教学，成为编程本身。</div>
                                    </div>
                                </li>
                                <li class="flex items-start">
                                    <i class="ri-terminal-box-line text-[var(--text-main)] mr-2.5 mt-[2px]"></i>
                                    <div>
                                        <strong>Pro-Code 视角：可视化 = 抽象理解 & 调试</strong>
                                        <div class="text-[#6b7280] text-[0.9em] mt-1">
                                            加速对复杂 DSL 的理解。核心价值在于：<br>
                                            <span class="text-dify font-semibold">“看得懂、比得出、说得清、做的快”</span>。
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="flex-1 text-left">
                            <img src="assets/Workflow+as+Visual+DSL.png" alt="工作流即DSL"
                                class="shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5 max-w-[520px] w-full mx-auto">
                        </div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h3>2.1 双轨示例：DSL ↔ Code Node</h3>
                        <p class="text-text-secondary text-[0.8em]">同一逻辑，两种形态，协同演进。</p>
                        <div class="grid grid-cols-2 gap-6">
                            <div class="bg-white rounded-xl border border-black/5 p-6 shadow-sm glow-card">
                                <div class="flex items-center gap-2 mb-3 text-sm font-semibold text-text-secondary">
                                    <i class="ri-node-tree text-dify"></i> Workflow 画布
                                </div>
                                <ul class="text-[0.75em] text-text-secondary space-y-2">
                                    <li class="flex items-start gap-2"><span class="text-dify">●</span> 变量映射：检索结果 → LLM → 条件分支</li>
                                    <li class="flex items-start gap-2"><span class="text-dify">●</span> 可视断点：节点级耗时、重试、采样率</li>
                                    <li class="flex items-start gap-2"><span class="text-dify">●</span> 业务可读：交付给运营/产品共建</li>
                                </ul>
                            </div>
                            <div class="bg-slate-900 text-slate-100 rounded-xl border border-black/5 p-5 shadow-sm">
                                <div class="flex items-center gap-2 text-sm font-semibold text-slate-200 mb-3">
                                    <i class="ri-code-line text-dify"></i> Code Node (Python)
                                </div>
                                <pre class="text-[0.65em] leading-[1.5] whitespace-pre-wrap bg-transparent border border-slate-700 rounded-lg p-3"><code>def handler(payload):
    country = payload["country"]
    score = risk_model.predict(payload)
    if country == "US" and score &lt; 0.2:
        return {"route": "fast-lane"}
    return {"route": "human-review", "score": score}</code></pre>
                                <div class="text-[0.7em] text-emerald-300 mt-2 animate-pulse">输出变量 auto-bind → 下游节点</div>
                            </div>
                        </div>
                    </div>
                </section>

                <section>
                    <div style="text-align: left; max-width: 900px;">
                        <h3>2.2 最佳实践：高密度开发模式</h3>
                        <p class="text-text-secondary" style="font-size: 0.8em; margin-bottom: 30px;">
                            利用 Dify 的可视化 DSL 处理 80% 的胶水逻辑，用 Pro-Code 解决 20% 的核心计算。
                        </p>
                        <div class="grid grid-cols-3 gap-5 text-left">
                            <div
                                class="bg-bg-card p-6 rounded-lg transition-transform duration-200 hover:-translate-y-1 text-left">
                                <i class="ri-mind-map text-[1.5em] text-dify mb-3 block"></i>
                                <h4 class="text-sm mb-2">可视编排 (DSL)</h4>
                                <p class="text-xs text-text-secondary leading-[1.5] m-0">处理分支、循环、RAG
                                    检索管道，利用可视化界面快速对齐业务需求。</p>
                            </div>
                            <div
                                class="bg-bg-card p-6 rounded-lg transition-transform duration-200 hover:-translate-y-1 text-left">
                                <i class="ri-code-box-line text-[1.5em] text-dify mb-3 block"></i>
                                <h4 class="text-sm mb-2">代码节点 (Code Node)</h4>
                                <p class="text-xs text-text-secondary leading-[1.5] m-0">在工作流中嵌入 Python/Node.js
                                    脚本，处理数据清洗与复杂数学计算。</p>
                            </div>
                            <div
                                class="bg-bg-card p-6 rounded-lg transition-transform duration-200 hover:-translate-y-1 text-left">
                                <i class="ri-pulse-line text-[1.5em] text-dify mb-3 block"></i>
                                <h4 class="text-sm mb-2">观测闭环 (Feedback)</h4>
                                <p class="text-xs text-text-secondary leading-[1.5] m-0">利用 Trace ID 串联会话日志，反向优化 Prompt
                                    与 代码逻辑。</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h3>2.3 调试视图 · 变量+日志</h3>
                        <div class="grid grid-cols-3 gap-5">
                            <div class="bg-bg-card rounded-xl border border-black/5 p-5 shadow-sm">
                                <div class="text-sm font-semibold text-text-secondary mb-2">变量快照</div>
                                <p class="text-[0.75em] text-text-secondary">节点级输入/输出对比，diff 高亮。</p>
                                <div class="text-[0.65em] bg-white rounded-md border border-black/5 p-3 mt-2 ticker-line">user_id: 91283 → 91283<br>country: CN → US (flag)</div>
                            </div>
                            <div class="bg-white rounded-xl border border-black/5 p-5 shadow-sm">
                                <div class="text-sm font-semibold text-text-secondary mb-2">Token & 成本</div>
                                <ul class="text-[0.75em] text-text-secondary space-y-1">
                                    <li>Prompt Tokens: 320</li>
                                    <li>Completion Tokens: 88</li>
                                    <li>成本: $0.0009 / req</li>
                                </ul>
                                <div class="h-2 w-full bg-slate-200 rounded-full mt-3 overflow-hidden">
                                    <div class="h-full bg-dify animate-pulse" style="width:35%;"></div>
                                </div>
                            </div>
                            <div class="bg-bg-card rounded-xl border border-black/5 p-5 shadow-sm">
                                <div class="text-sm font-semibold text-text-secondary mb-2">日志 & Trace</div>
                                <p class="text-[0.75em] text-text-secondary">点击 Trace ID 跳转至 Jaeger / SLS。</p>
                                <code class="text-[0.65em] block bg-slate-900 text-slate-100 rounded p-3 mt-2">trace_id=wf-1827 span=llm.call status=ok p95=180ms</code>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Section 2.4: Prompt as Code -->
                <section>
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>2.4 Prompt Engineering as Code</h3>
                        <p class="text-text-secondary text-[0.8em] mb-6">像管理代码一样管理 Prompt：版本控制与差异对比。</p>
                        
                        <div class="grid grid-cols-2 gap-6">
                            <div class="bg-[#1e1e1e] rounded-lg p-4 font-mono text-[0.55em] text-gray-300 shadow-lg">
                                <div class="flex justify-between border-b border-gray-700 pb-2 mb-2">
                                    <span>prompts/customer_service.yaml</span>
                                    <span class="text-gray-500">v2.1.0</span>
                                </div>
                                <div class="text-blue-400">system_prompt: |</div>
                                <div class="pl-4 text-green-400">You are a helpful assistant.</div>
                                <div class="pl-4 text-gray-400"># Context variables</div>
                                <div class="pl-4">Current User: {{ user_name }}</div>
                                <div class="pl-4">History: {{ conversation_history }}</div>
                                <div class="mt-2 text-blue-400">parameters:</div>
                                <div class="pl-4">temperature: 0.7</div>
                                <div class="pl-4">model: gpt-4-turbo</div>
                            </div>
                            
                            <div class="bg-white rounded-lg p-4 border border-black/5 shadow-sm flex flex-col justify-center">
                                <div class="text-sm font-semibold text-dify mb-3"><i class="ri-git-merge-line"></i> Version Diff</div>
                                <div class="space-y-2 text-[0.65em]">
                                    <div class="bg-red-50 text-red-700 p-2 rounded border border-red-100 flex gap-2">
                                        <span>-</span>
                                        <span class="line-through">model: gpt-3.5-turbo</span>
                                    </div>
                                    <div class="bg-green-50 text-green-700 p-2 rounded border border-green-100 flex gap-2">
                                        <span>+</span>
                                        <span>model: gpt-4-turbo</span>
                                    </div>
                                    <div class="text-gray-400 text-xs mt-2 italic">Updated by @zhengli 2 hours ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Section 2.5: Team Collaboration -->
                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>2.5 团队协作机制</h3>
                        <p class="text-text-secondary text-[0.8em] mb-8">明确分工，打破 Prompt 工程师与开发者的壁垒。</p>
                        
                        <div class="grid grid-cols-3 gap-6">
                            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative overflow-hidden group hover:-translate-y-1 transition-transform">
                                <div class="absolute top-0 right-0 bg-gray-200 text-gray-600 text-[0.6em] px-2 py-1 rounded-bl">Admin</div>
                                <div class="text-4xl mb-4 text-gray-700"><i class="ri-settings-4-line"></i></div>
                                <h4 class="text-base font-bold mb-2">基础设施负责人</h4>
                                <ul class="text-[0.65em] text-gray-500 space-y-1">
                                    <li>• 模型供应商配置</li>
                                    <li>• API Key 管理</li>
                                    <li>• 向量数据库维护</li>
                                </ul>
                            </div>
                            
                            <div class="bg-blue-50 p-6 rounded-xl border border-blue-200 shadow-sm relative overflow-hidden group hover:-translate-y-1 transition-transform">
                                <div class="absolute top-0 right-0 bg-dify text-white text-[0.6em] px-2 py-1 rounded-bl">Builder</div>
                                <div class="text-4xl mb-4 text-dify"><i class="ri-tools-line"></i></div>
                                <h4 class="text-base font-bold mb-2">应用开发者</h4>
                                <ul class="text-[0.65em] text-blue-800 space-y-1">
                                    <li>• Prompt 编排与调试</li>
                                    <li>• Workflow 逻辑设计</li>
                                    <li>• 发布与版本管理</li>
                                </ul>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative overflow-hidden group hover:-translate-y-1 transition-transform">
                                <div class="absolute top-0 right-0 bg-gray-200 text-gray-600 text-[0.6em] px-2 py-1 rounded-bl">Operator</div>
                                <div class="text-4xl mb-4 text-gray-700"><i class="ri-user-voice-line"></i></div>
                                <h4 class="text-base font-bold mb-2">业务运营</h4>
                                <ul class="text-[0.65em] text-gray-500 space-y-1">
                                    <li>• 日志查看与标注</li>
                                    <li>• 效果反馈</li>
                                    <li>• 知识库数据上传</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Section 2.6: Complex Logic -->
                <section>
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>2.6 复杂逻辑编排能力</h3>
                        <p class="text-text-secondary text-[0.8em] mb-6">不仅是线性流，支持循环、迭代与条件判断。</p>
                        
                        <div class="bg-white p-8 rounded-xl border border-black/5 shadow-sm relative">
                            <!-- Visual representation of a complex flow -->
                            <div class="flex items-center justify-center gap-4 text-[0.7em]">
                                <div class="flex flex-col items-center">
                                    <div class="bg-green-100 text-green-700 px-4 py-2 rounded-lg border border-green-200 font-mono">Start</div>
                                    <i class="ri-arrow-down-line text-gray-400 my-1"></i>
                                    <div class="bg-white px-4 py-2 rounded-lg border border-gray-300 font-mono">Input Check</div>
                                </div>
                                
                                <i class="ri-arrow-right-line text-gray-400"></i>
                                
                                <div class="border-2 border-dashed border-dify/30 p-4 rounded-xl bg-blue-50/50 relative">
                                    <div class="absolute -top-3 left-4 bg-white px-2 text-dify text-xs font-bold">Iteration Node</div>
                                    <div class="flex items-center gap-2">
                                        <div class="bg-white px-3 py-2 rounded border border-gray-200">Item A</div>
                                        <i class="ri-arrow-right-line text-gray-400"></i>
                                        <div class="bg-dify text-white px-3 py-2 rounded shadow-lg">LLM Process</div>
                                        <i class="ri-arrow-right-line text-gray-400"></i>
                                        <div class="bg-white px-3 py-2 rounded border border-gray-200">Result</div>
                                    </div>
                                </div>
                                
                                <i class="ri-arrow-right-line text-gray-400"></i>
                                
                                <div class="flex flex-col items-center">
                                    <div class="bg-orange-100 text-orange-700 px-4 py-2 rounded-lg border border-orange-200 font-mono">If / Else</div>
                                    <div class="flex gap-4 mt-2 text-xs text-gray-400">
                                        <span>Pass</span>
                                        <span>Fail</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Section 3: 扩展 -->
            <section>
                <section data-background-color="#f9fafb">
                    <div class="slide-hero">
                        <h2>扩展 · 构建你的军火库</h2>
                        <p>Marketplace & Plugins：把 Dify 当成“平台的基础设施”。</p>
                        <img src="assets/Plugin+Marketplace+Gallery.png" alt="插件市场"
                            class="slide-visual shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5">
                    </div>
                </section>

                <section>
                    <div style="text-align: left; margin-bottom: 20px;">
                        <h3>3.1 Dify Plugin 架构解析</h3>
                        <p class="text-text-secondary" style="font-size: 0.8em;">标准化接口、鉴权与多语言运行时。</p>
                    </div>
                    <div class="flex justify-between text-left gap-5 mb-5 flex-wrap">
                        <div class="flex-1 min-w-[160px]">
                            <i
                                class="ri-terminal-window-line text-[1.2em] text-dify bg-dify-light p-2 rounded-full mb-2 inline-block"></i>
                            <strong class="block text-[0.75em] mb-1">Runtime</strong>
                            <p class="text-[0.55em] text-text-secondary leading-[1.4]">隔离执行环境，控制超时与重试。</p>
                        </div>
                        <div class="flex-1 min-w-[160px]">
                            <i
                                class="ri-key-2-line text-[1.2em] text-dify bg-dify-light p-2 rounded-full mb-2 inline-block"></i>
                            <strong class="block text-[0.75em] mb-1">Auth</strong>
                            <p class="text-[0.55em] text-text-secondary leading-[1.4]">支持 API Key / OAuth / 内部凭据。</p>
                        </div>
                        <div class="flex-1 min-w-[160px]">
                            <i
                                class="ri-exchange-dollar-fill text-[1.2em] text-dify bg-dify-light p-2 rounded-full mb-2 inline-block"></i>
                            <strong class="block text-[0.75em] mb-1">Billing</strong>
                            <p class="text-[0.55em] text-text-secondary leading-[1.4]">调用计费与配额管理可插拔。</p>
                        </div>
                        <div class="flex-1 min-w-[160px]">
                            <i
                                class="ri-box-3-line text-[1.2em] text-dify bg-dify-light p-2 rounded-full mb-2 inline-block"></i>
                            <strong class="block text-[0.75em] mb-1">Packaging</strong>
                            <p class="text-[0.55em] text-text-secondary leading-[1.4]">Marketplace 发布与版本化。</p>
                        </div>
                    </div>
                    <div>
                        <img src="assets/Plugin+Architecture+Diagram.png" alt="插件架构图"
                            class="w-full max-w-5xl mx-auto block shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5">
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h3>3.1 调用示例：Slack Bot Plugin</h3>
                        <div class="grid grid-cols-2 gap-6">
                            <div class="bg-white rounded-xl border border-black/5 p-5 shadow-sm glow-card">
                                <div class="flex items-center gap-2 text-sm font-semibold text-text-secondary mb-3">
                                    <i class="ri-terminal-window-line text-dify"></i> 请求示例 (cURL)
                                </div>
                                <pre class="text-[0.65em] leading-[1.6] whitespace-pre-wrap bg-slate-900 text-slate-100 rounded-lg p-4"><code>curl -X POST https://api.dify.ai/plugins/slack_bot \\
  -H "Authorization: Bearer &lt;token&gt;" \\
  -d '{
    "channel_id": "ops-alert",
    "text": "Build passed ✅",
    "bot_token": "******"
  }'</code></pre>
                            </div>
                            <div class="bg-bg-card rounded-xl border border-black/5 p-5 shadow-sm">
                                <div class="flex items-center gap-2 text-sm font-semibold text-text-secondary mb-3">
                                    <i class="ri-bar-chart-box-line text-dify"></i> 响应 & 观测
                                </div>
                                <ul class="text-[0.8em] text-text-secondary space-y-2">
                                    <li>status: <span class="text-emerald-600 font-semibold">success</span></li>
                                    <li>message_ts: <code class="text-dify">171103.23</code></li>
                                    <li>trace_id: <code class="text-dify">plugin-9821</code> (跳转日志)</li>
                                </ul>
                                <div class="mt-4 grid grid-cols-3 gap-3 text-[0.75em] text-text-secondary">
                                    <div class="bg-white rounded-lg border border-black/5 p-3 text-center">
                                        <div class="text-lg font-semibold text-dify">180ms</div>
                                        <div class="text-xs">p95</div>
                                    </div>
                                    <div class="bg-white rounded-lg border border-black/5 p-3 text-center">
                                        <div class="text-lg font-semibold text-dify">0.0003</div>
                                        <div class="text-xs">Cost $</div>
                                    </div>
                                    <div class="bg-white rounded-lg border border-black/5 p-3 text-center">
                                        <div class="text-lg font-semibold text-dify">99.9%</div>
                                        <div class="text-xs">成功率</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h3>3.2 发布流水线 · 4 步上线</h3>
                        <div class="grid grid-cols-4 gap-4">
                            <div class="bg-bg-card rounded-xl border border-black/5 p-4 text-center glow-card">
                                <div class="text-dify text-xl mb-2">1</div>
                                <div class="text-sm font-semibold">定义</div>
                                <p class="text-[0.7em] text-text-secondary mt-1">manifest + schema</p>
                            </div>
                            <div class="bg-bg-card rounded-xl border border-black/5 p-4 text-center glow-card">
                                <div class="text-dify text-xl mb-2">2</div>
                                <div class="text-sm font-semibold">开发</div>
                                <p class="text-[0.7em] text-text-secondary mt-1">code node / runtime</p>
                            </div>
                            <div class="bg-bg-card rounded-xl border border-black/5 p-4 text-center glow-card">
                                <div class="text-dify text-xl mb-2">3</div>
                                <div class="text-sm font-semibold">验证</div>
                                <p class="text-[0.7em] text-text-secondary mt-1">本地 + 沙箱</p>
                            </div>
                            <div class="bg-bg-card rounded-xl border border-black/5 p-4 text-center glow-card">
                                <div class="text-dify text-xl mb-2">4</div>
                                <div class="text-sm font-semibold">发布</div>
                                <p class="text-[0.7em] text-text-secondary mt-1">Marketplace / 内部</p>
                            </div>
                        </div>
                        <div class="h-1 bg-gradient-to-r from-dify to-blue-200 rounded-full animate-pulse"></div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="flex h-full items-center gap-[60px]">
                        <div class="flex-1 text-left">
                            <h3>3.2 实战：开发 Slack Bot 插件</h3>
                            <p class="text-text-secondary text-[0.8em] mb-5">
                                以开发一个 Slack 消息发送工具为例，演示 Dify 插件的“定义即开发”流程。
                            </p>
                            <div class="text-[0.75em] text-text-secondary leading-[1.8] space-y-3">
                                <div>🗂️ <strong>Manifest 定义 (YAML):</strong> 定义插件元数据（Identity）和 Tool 参数（如 <code class="text-dify">bot_token</code>, <code class="text-dify">channel_id</code>）。</div>
                                <div>💻 <strong>代码实现 (Python):</strong> 继承 <code class="text-dify">Tool</code> 类，在 <code class="text-dify">_invoke</code> 方法中调用 Slack SDK 发送消息。</div>
                                <div>✅ <strong>调试与发布:</strong> 本地验证 <code class="text-dify">invoke</code> 结果，打包发布至 Dify Marketplace。</div>
                            </div>
                        </div>
                        <div class="flex-1 text-left">
                            <!-- Code Editor Window for Slack Bot -->
                            <div
                                style="background: #1e1e1e; border-radius: 8px; padding: 20px; font-family: 'Fira Code', monospace; font-size: 0.55em; color: #d4d4d4; box-shadow: 0 15px 40px rgba(0,0,0,0.4); text-align: left; height: 400px; overflow: hidden; display: flex; flex-direction: column;">

                                <!-- Fake Tabs -->
                                <div
                                    style="display: flex; gap: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 10px;">
                                    <div
                                        style="color: #fff; font-weight: 600; border-bottom: 2px solid var(--dify-blue); padding-bottom: 4px;">
                                        manifest.yaml</div>
                                    <div style="color: #888;">main.py</div>
                                </div>

                                <div style="overflow-y: auto; flex: 1;">
                                    <!-- YAML Content -->
                                    <div style="color: #569cd6;">identity:</div>
                                    <div style="padding-left: 20px;">name: <span
                                            style="color: #ce9178;">slack_bot</span></div>
                                    <div style="padding-left: 20px;">label: { en_US: <span style="color: #ce9178;">Slack
                                            Bot</span> }</div>

                                    <div style="color: #569cd6; margin-top: 10px;">parameters:</div>
                                    <div style="padding-left: 20px; color: #6a9955;"># 定义输入参数: Token (Secret) & Channel
                                    </div>
                                    <div style="padding-left: 20px;">- name: <span
                                            style="color: #ce9178;">bot_token</span></div>
                                    <div style="padding-left: 30px;">type: <span
                                            style="color: #ce9178;">secret-input</span></div>
                                    <div style="padding-left: 20px;">- name: <span
                                            style="color: #ce9178;">channel_id</span></div>
                                    <div style="padding-left: 30px;">type: <span style="color: #ce9178;">string</span>
                                    </div>
                                    <div style="padding-left: 20px;">- name: <span style="color: #ce9178;">text</span>
                                    </div>
                                    <div style="padding-left: 30px;">type: <span style="color: #ce9178;">string</span>
                                    </div>

                                    <!-- Divider -->
                                    <div style="height: 1px; background: #333; margin: 15px 0;"></div>
                                    <div style="color: #888; font-size: 0.9em; margin-bottom: 5px;">// main.py Preview
                                    </div>

                                    <!-- Python Content -->
                                    <div><span style="color: #c586c0;">class</span> <span
                                            style="color: #dcdcaa;">SlackBotTool</span>(Tool):</div>
                                    <div style="padding-left: 20px;"><span style="color: #c586c0;">def</span> <span
                                            style="color: #dcdcaa;">_invoke</span>(self, params: dict):</div>
                                    <div style="padding-left: 40px; color: #6a9955;"># 1. 获取凭据与参数</div>
                                    <div style="padding-left: 40px;">token = params.get(<span
                                            style="color: #ce9178;">'bot_token'</span>)</div>
                                    <div style="padding-left: 40px;">client = WebClient(token=token)</div>

                                    <div style="padding-left: 40px; margin-top: 5px; color: #6a9955;"># 2. 执行业务逻辑 (Call
                                        SDK)</div>
                                    <div style="padding-left: 40px;">res = client.chat_postMessage(</div>
                                    <div style="padding-left: 60px;">channel=params.get(<span
                                            style="color: #ce9178;">'channel_id'</span>),</div>
                                    <div style="padding-left: 60px;">text=params.get(<span
                                            style="color: #ce9178;">'text'</span>)</div>
                                    <div style="padding-left: 40px;">)</div>
                                    <div style="padding-left: 40px;"><span style="color: #c586c0;">return</span> { <span
                                            style="color: #ce9178;">"result"</span>: res.data }</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Section 3.3: Tool Security -->
                <section>
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>3.3 工具安全与沙箱机制</h3>
                        <p class="text-text-secondary text-[0.8em] mb-6">不信任任何第三方代码，确保主程序安全稳定。</p>
                        
                        <div class="flex items-center justify-center gap-8 mt-10">
                            <div class="bg-white p-6 rounded-xl border border-red-200 shadow-sm w-64 text-center">
                                <div class="text-red-600 text-4xl mb-2"><i class="ri-error-warning-line"></i></div>
                                <h4 class="font-bold mb-2">Unsafe Zone</h4>
                                <p class="text-xs text-text-secondary">第三方 Plugin 代码<br>任意网络请求<br>高资源消耗</p>
                            </div>
                            
                            <div class="flex flex-col items-center gap-2 text-dify">
                                <i class="ri-arrow-left-right-line text-2xl"></i>
                                <span class="text-xs font-mono bg-blue-50 px-2 py-1 rounded">gRPC / Socket</span>
                            </div>
                            
                            <div class="bg-dify p-6 rounded-xl border border-dify shadow-lg w-64 text-center text-white">
                                <div class="text-white text-4xl mb-2"><i class="ri-shield-check-line"></i></div>
                                <h4 class="font-bold mb-2">Safe Sandbox</h4>
                                <p class="text-xs text-blue-100">Namespace 隔离<br>资源配额限制<br>网络白名单</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Section 3.4: Reverse Invocation -->
                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>3.4 进阶：工具逆向调用 Workflow</h3>
                        <p class="text-text-secondary text-[0.8em] mb-6">Agentic Behavior: 插件不仅仅是执行者，也可以是决策者。</p>
                        
                        <div class="bg-[#1e1e1e] rounded-xl p-6 shadow-2xl">
                            <div class="font-mono text-xs text-gray-400 mb-4"># plugin_logic.py: Plugin decides to call another workflow</div>
                            <pre class="text-[0.6em] font-mono text-gray-300"><code>
def _invoke(self, params):
    user_intent = analyze_intent(params['input'])
    
    if user_intent == 'complex_task':
        <span class="text-green-400"># Reverse call back to Dify API</span>
        response = dify_client.run_workflow(
            workflow_id="wf-sub-task-001",
            inputs={"query": params['input']},
            user_id=params['user_id']
        )
        return {"result": response['data'], "delegated": True}
        
    return {"result": simple_process(params), "delegated": False}
                            </code></pre>
                        </div>
                    </div>
                </section>

                <!-- New Section 3.5: Marketplace Economy -->
                <section>
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>3.5 插件市场经济展望</h3>
                        <p class="text-text-secondary text-[0.8em] mb-8">连接开发者与企业用户，共建价值闭环。</p>
                        
                        <div class="grid grid-cols-3 gap-8 text-center">
                            <div class="p-6 bg-white rounded-xl border border-black/5 hover:shadow-md transition-shadow">
                                <div class="text-4xl mb-4">👩‍💻</div>
                                <h4 class="font-bold mb-2">Creators</h4>
                                <p class="text-xs text-text-secondary">开发高质量插件<br>发布到 Marketplace<br>获得收益分成</p>
                            </div>
                            <div class="p-6 bg-white rounded-xl border border-black/5 hover:shadow-md transition-shadow">
                                <div class="text-4xl mb-4">🚀</div>
                                <h4 class="font-bold mb-2">Platform</h4>
                                <p class="text-xs text-text-secondary">提供分发渠道<br>处理计费与结算<br>保障安全审核</p>
                            </div>
                            <div class="p-6 bg-white rounded-xl border border-black/5 hover:shadow-md transition-shadow">
                                <div class="text-4xl mb-4">🏢</div>
                                <h4 class="font-bold mb-2">Consumers</h4>
                                <p class="text-xs text-text-secondary">一键安装能力<br>按需付费订阅<br>解决业务痛点</p>
                            </div>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Section 4: 连接 -->
            <section>
                <section data-background-color="#f9fafb">
                    <div class="slide-hero">
                        <h2>连接 · 事件驱动的自动化</h2>
                        <p>Trigger 让应用从“被动问答”迈向“主动执行”。</p>
                        <img src="assets/Event-Driven-Automation.png" alt="事件驱动自动化"
                            class="slide-visual shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5">
                    </div>
                </section>

                <section>
                    <div class="flex h-full items-center gap-[60px]">
                        <div class="flex-1 text-left">
                            <h3>4.1 Trigger 的本质</h3>
                            <ul class="list-none m-0 p-0 space-y-[15px] text-[0.8em]">
                                <li class="flex items-start">
                                    <i class="ri-close-circle-fill text-red-600 mr-2.5 mt-[2px]"></i>
                                    <div>Passive Response：等待用户提问，缺少上下文与时效。</div>
                                </li>
                                <li class="flex items-start">
                                    <i class="ri-checkbox-circle-fill text-dify mr-2.5 mt-[2px]"></i>
                                    <div>Active Execution：事件驱动，自动拉起 Workflow 完成动作。</div>
                                </li>
                            </ul>
                        </div>
                        <div class="flex-1 text-left">
                            <img src="assets/Event+Trigger+Flow.png" alt="事件触发流程"
                                class="shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5 max-w-[520px] w-full mx-auto">
                        </div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h3>4.1 自动化动画：事件 → Workflow</h3>
                        <div class="grid grid-cols-3 gap-5 items-center">
                            <div class="bg-white rounded-xl border border-black/5 p-5 shadow-sm">
                                <div class="text-sm font-semibold text-text-secondary mb-2">事件源</div>
                                <ul class="text-[0.75em] text-text-secondary space-y-1">
                                    <li>Webhook: /orders/created</li>
                                    <li>Plugin: GitHub PR</li>
                                    <li>Schedule: cron(0/10 * * *)</li>
                                </ul>
                            </div>
                            <div class="flex flex-col gap-3">
                                <div class="h-14 bg-gradient-to-r from-dify-light to-white border border-black/5 rounded-xl flex items-center px-4 ticker-line">
                                    <span class="text-text-secondary text-sm">事件 → 变量映射 → 条件路由</span>
                                </div>
                                <div class="h-14 bg-gradient-to-r from-emerald-50 to-white border border-black/5 rounded-xl flex items-center px-4 animate-pulse">
                                    <span class="text-emerald-700 text-sm">LLM 选择模型 · 自动重试</span>
                                </div>
                                <div class="h-14 bg-gradient-to-r from-orange-50 to-white border border-black/5 rounded-xl flex items-center px-4">
                                    <span class="text-orange-700 text-sm">回调 / 写库 / 通知</span>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-black/5 p-5 shadow-sm">
                                <div class="text-sm font-semibold text-text-secondary mb-2">可观测</div>
                                <ul class="text-[0.75em] text-text-secondary space-y-1">
                                    <li>Trace ID: trig-2039</li>
                                    <li>p95: 420ms</li>
                                    <li>Drools/Rules: version v2.1</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div style="text-align: left; margin-bottom: 14px;">
                        <h3>4.2 场景演示</h3>
                        <p class="text-text-secondary" style="font-size: 0.8em;">外部 Webhook -> Dify 解析 Payload -> LLM 决策
                            -> 输出结果。</p>
                    </div>
                    <div class="flex justify-between text-left gap-5 mb-10 flex-wrap">
                        <div class="flex-1 min-w-[160px]">
                            <i
                                class="ri-global-line text-[1.2em] text-dify bg-dify-light p-2 rounded-full mb-2 inline-block"></i>
                            <strong class="block text-[0.75em] mb-1">Webhook</strong>
                            <p class="text-[0.55em] text-text-secondary leading-[1.4]">接收外部事件，校验签名。</p>
                        </div>
                        <div class="flex-1 min-w-[160px]">
                            <i
                                class="ri-cpu-line text-[1.2em] text-dify bg-dify-light p-2 rounded-full mb-2 inline-block"></i>
                            <strong class="block text-[0.75em] mb-1">LLM Routing</strong>
                            <p class="text-[0.55em] text-text-secondary leading-[1.4]">基于上下文选择模型与链路。</p>
                        </div>
                        <div class="flex-1 min-w-[160px]">
                            <i
                                class="ri-loop-left-line text-[1.2em] text-dify bg-dify-light p-2 rounded-full mb-2 inline-block"></i>
                            <strong class="block text-[0.75em] mb-1">Action</strong>
                            <p class="text-[0.55em] text-text-secondary leading-[1.4]">调用 Plugin/Tool，写入结果。</p>
                        </div>
                        <div class="flex-1 min-w-[160px]">
                            <i
                                class="ri-bar-chart-line text-[1.2em] text-dify bg-dify-light p-2 rounded-full mb-2 inline-block"></i>
                            <strong class="block text-[0.75em] mb-1">Observe</strong>
                            <p class="text-[0.55em] text-text-secondary leading-[1.4]">Tracing + Token 成本监控。</p>
                        </div>
                    </div>
                    <div>
                        <img src="assets/Event-Driven-Triggers.png" alt="触发器工作流界面"
                            class="w-full max-w-5xl mx-auto block shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5">
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="text-left max-w-[1000px]">
                        <h3>4.3 为什么需要 Trigger？</h3>
                        <ul class="text-text-secondary text-[0.8em] leading-[1.6] space-y-3 mt-4">
                            <li><strong class="text-[var(--text-main)]">避免触发分散：</strong>UI 按钮、Cron、业务系统直调各自为政，难以排查和治理。
                            </li>
                            <li><strong class="text-[var(--text-main)]">让编排决定“何时启动”：</strong>把触发逻辑收回 Workflow
                                编排层，统一监听与路由。</li>
                            <li><strong class="text-[var(--text-main)]">常驻后台的服务形态：</strong>Workflow
                                持续在线监听事件，满足条件即携带上下文启动。</li>
                            <li><strong class="text-[var(--text-main)]">多路触发同盘编排：</strong>一个画布可配置多个
                                Trigger，先分支后汇合，逻辑一目了然。</li>
                        </ul>
                    </div>
                </section>

                <section>
                    <div class="text-left">
                        <h3>4.4 Trigger 类型（v1.10.0）</h3>
                        <p class="text-text-secondary text-[0.8em] mb-5">覆盖定时、第三方事件和自建系统三大场景。</p>
                    </div>
                    <div class="grid grid-cols-3 gap-5 text-left">
                        <div class="bg-bg-card p-6 rounded-lg border border-black/5">
                            <div class="flex items-center gap-3 mb-3">
                                <i class="ri-time-line text-dify text-xl"></i>
                                <div class="font-semibold text-sm">Schedule Trigger</div>
                            </div>
                            <p class="text-text-secondary text-xs leading-[1.5] m-0">按固定节奏启动：日报、数据清理、健康检查等可预测任务。</p>
                        </div>
                        <div class="bg-bg-card p-6 rounded-lg border border-black/5">
                            <div class="flex items-center gap-3 mb-3">
                                <i class="ri-plug-2-line text-dify text-xl"></i>
                                <div class="font-semibold text-sm">Plugin Trigger</div>
                            </div>
                            <p class="text-text-secondary text-xs leading-[1.5] m-0">第三方事件驱动：PR
                                更新、工单变更、文档改动等。插件负责订阅和解析结构化 Payload，可一份订阅驱动多条 Workflow。</p>
                        </div>
                        <div class="bg-bg-card p-6 rounded-lg border border-black/5">
                            <div class="flex items-center gap-3 mb-3">
                                <i class="ri-link text-dify text-xl"></i>
                                <div class="font-semibold text-sm">Webhook Trigger</div>
                            </div>
                            <p class="text-text-secondary text-xs leading-[1.5] m-0">面向自有/遗留系统。为每个 Trigger 生成唯一 HTTP
                                URL，Query/Header/Body 直接转为变量；可将 Workflow 结果回传调用方。</p>
                        </div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h3>4.4 用例矩阵</h3>
                        <div class="quadrant mt-4">
                            <div class="quadrant-label" style="top:8px; left:8px;">实时</div>
                            <div class="quadrant-label" style="top:8px; right:8px;">高复杂</div>
                            <div class="quadrant-label" style="bottom:8px; left:8px;">批量</div>
                            <div class="quadrant-label" style="bottom:8px; right:8px;">标准化</div>

                            <div class="quadrant-item" style="top:18%; left:20%;">监控告警<br><span class="text-dify text-[0.75em]">Prom → Trigger → Slack</span></div>
                            <div class="quadrant-item" style="top:28%; right:18%;">代码审查<br><span class="text-dify text-[0.75em]">PR → Plugin Trigger → 摘要</span></div>
                            <div class="quadrant-item" style="bottom:18%; left:22%;">RAG 回放<br><span class="text-dify text-[0.75em]">KB 更新 → 重跑 → Diff</span></div>
                            <div class="quadrant-item" style="bottom:22%; right:22%;">CRM 自动化<br><span class="text-dify text-[0.75em]">线索 → Workflow → 邮件/工单</span></div>
                            <div class="quadrant-item" style="top:55%; left:46%;">内容审核<br><span class="text-dify text-[0.75em]">Webhook → 多模态 → 封禁</span></div>
                            <div class="quadrant-item" style="top:40%; right:40%;">电商履约<br><span class="text-dify text-[0.75em]">订单 → LLM 路由 → 仓储</span></div>
                        </div>
                    </div>
                </section>

                <section data-background-color="#f9fafb">
                    <div class="text-left max-w-[1000px]">
                        <h3>4.5 实战示例：GitHub PR 自动审查</h3>
                        <p class="text-text-secondary text-[0.8em] mb-6">结合 Plugin Trigger 与 LLM，让代码变更自动进入智能审查流程。</p>
                        <div class="roadmap-horizontal">
                            <div class="roadmap-h-step">
                                <div class="roadmap-card bg-white p-5 rounded-lg border border-black/5 shadow-sm flex flex-col gap-1">
                                    <div class="text-xs font-semibold text-dify mb-1">🛰️ 订阅事件</div>
                                    <div class="text-text-secondary text-[0.75em] leading-[1.6]">GitHub Trigger 订阅非 Draft、目标 main 的 PR 事件。</div>
                                    <span class="text-xs text-text-secondary bg-slate-100 px-2 py-1 rounded-full animate-pulse w-fit">t0</span>
                                </div>
                            </div>
                            <div class="roadmap-h-step">
                                <div class="roadmap-card bg-bg-card p-5 rounded-lg border border-black/5 flex flex-col gap-1">
                                    <div class="text-xs font-semibold text-dify mb-1">📥 变量入流</div>
                                    <div class="text-text-secondary text-[0.75em] leading-[1.6]">解析 payload → <code class="text-dify">action</code>/<code class="text-dify">pull_request</code>/<code class="text-dify">repo</code>/<code class="text-dify">sender</code>。</div>
                                    <span class="text-xs text-emerald-700 bg-emerald-50 px-2 py-1 rounded-full w-fit">t0+30ms</span>
                                </div>
                            </div>
                            <div class="roadmap-h-step">
                                <div class="roadmap-card bg-white p-5 rounded-lg border border-black/5 shadow-sm flex flex-col gap-1">
                                    <div class="text-xs font-semibold text-dify mb-1">🤖 LLM 审查与反馈</div>
                                    <div class="text-text-secondary text-[0.75em] leading-[1.6]">生成审查摘要，条件判断：自动评论 / 请求变更 / 触发 CI。</div>
                                    <span class="text-xs text-orange-700 bg-orange-50 px-2 py-1 rounded-full animate-pulse w-fit">t0+180ms</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- New Section 4.6: Event Bus -->
                <section>
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>4.6 技术揭秘：高并发事件总线架构</h3>
                        <p class="text-text-secondary text-[0.8em] mb-6">如何确保海量 Trigger 事件不丢失、不阻塞。</p>
                        
                        <div class="flex items-center justify-center gap-4 bg-white p-8 rounded-xl border border-black/5">
                            <div class="text-center">
                                <div class="bg-purple-100 text-purple-700 p-4 rounded-lg border border-purple-200"><i class="ri-global-line text-2xl"></i></div>
                                <div class="text-[0.6em] mt-2">External Sources</div>
                            </div>
                            
                            <i class="ri-arrow-right-line text-gray-300"></i>
                            
                            <div class="bg-white p-4 rounded-lg border border-gray-200 text-center shadow-sm w-32">
                                <div class="text-xs font-bold mb-1">API Gateway</div>
                                <div class="text-[0.5em] text-gray-500">Validation & Auth</div>
                            </div>
                            
                            <i class="ri-arrow-right-line text-gray-300"></i>
                            
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200 text-center w-32 relative">
                                <div class="absolute -top-2 -right-2 bg-red-500 text-white text-[0.5em] px-1 rounded-full">MQ</div>
                                <div class="text-xs font-bold text-red-700 mb-1">Redis Broker</div>
                                <div class="text-[0.5em] text-red-500">FIFO Queue</div>
                            </div>
                            
                            <i class="ri-arrow-right-line text-gray-300"></i>
                            
                            <div class="bg-dify p-4 rounded-lg border border-dify text-center text-white w-40">
                                <div class="text-xs font-bold mb-1">Celery Worker</div>
                                <div class="text-[0.5em] text-blue-100">Workflow Execution</div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- New Section 4.7: Customer Support Case -->
                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>4.7 真实案例：智能客服工单路由</h3>
                        <p class="text-text-secondary text-[0.8em] mb-8">从邮件接收到自动分类、回复草拟的全流程。</p>
                        
                        <div class="space-y-4">
                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-xs">1</div>
                                <div>
                                    <h4 class="text-sm font-bold">Email Trigger</h4>
                                    <p class="text-xs text-gray-500">客户发送邮件至 support@company.com → Webhook 触发 Dify。</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200 ml-8">
                                <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold text-xs">2</div>
                                <div>
                                    <h4 class="text-sm font-bold">Intent Classification (LLM)</h4>
                                    <p class="text-xs text-gray-500">分析邮件内容：是 "退款请求"、"技术故障" 还是 "一般咨询"？</p>
                                </div>
                            </div>
                            
                            <div class="flex gap-4 ml-16">
                                <div class="flex-1 p-3 bg-red-50 border border-red-100 rounded text-center text-[0.7em] text-red-700">
                                    <strong>退款</strong><br>调用 Stripe 插件查询订单状态
                                </div>
                                <div class="flex-1 p-3 bg-green-50 border border-green-100 rounded text-center text-[0.7em] text-green-700">
                                    <strong>技术</strong><br>检索 RAG 知识库匹配解决方案
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200 ml-8">
                                <div class="w-8 h-8 rounded-full bg-dify flex items-center justify-center text-white font-bold text-xs">3</div>
                                <div>
                                    <h4 class="text-sm font-bold">Human-in-the-loop</h4>
                                    <p class="text-xs text-gray-500">生成草稿回复 → 发送至 Slack 供人工审核 → 点击确认发送。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Section 5: 洞察 (New Enhanced Section) -->
            <section>
                <!-- 5.0 Chapter Cover -->
                <section data-background-color="#f9fafb">
                    <div class="slide-hero">
                        <h2>洞察 · 开源社区的极客精神</h2>
                        <p>透明、可观测、可移植的工程能力。</p>
                        <img src="assets/OpenTelemetry+Database+Flexibility.png" alt="开源洞察"
                            class="slide-visual shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-lg border border-black/5">
                    </div>
                </section>

                <!-- 5.1 Overview with HTML-based Architecture Diagram -->
                <section>
                    <div class="slide-hero">
                        <h2>5.1 OTEL 全链路追踪实战</h2>
                        <p>不仅是日志，更是贯穿 LLM 与 Infra 的“上帝视角”。</p>
                        <div
                            class="mt-6 relative h-[380px] bg-white rounded-xl border border-slate-200 shadow-[0_10px_30px_-10px_rgba(0,0,0,0.08)] flex items-center justify-center">
                            <div class="absolute top-4 left-4 text-xs text-text-secondary bg-white px-3 py-1 rounded-full border border-slate-200 shadow-sm">Trace Link</div>
                            <div class="grid grid-cols-5 gap-4 w-full px-6">
                                <div class="col-span-1 text-center">
                                    <div
                                        class="bg-gradient-to-br from-blue-50 to-white border-2 border-dify px-4 py-5 rounded-xl text-dify font-semibold shadow-md">
                                        <i class="ri-layout-grid-fill text-2xl block mb-2"></i>
                                        Workflow App
                                        <div class="text-[0.65em] text-text-secondary bg-white/80 px-2 py-1 rounded mt-2 inline-block">Trace ID: T-1001</div>
                                    </div>
                                </div>
                                <div class="col-span-1 flex flex-col justify-center items-center text-[0.75em] text-text-secondary">
                                    <div class="h-1 w-20 bg-slate-200 relative overflow-hidden rounded-full">
                                        <div class="absolute inset-0 bg-gradient-to-r from-dify/60 to-transparent animate-[sweep_3s_linear_infinite]"></div>
                                    </div>
                                    <div class="mt-2 text-center">HTTP Header<br>Propagation</div>
                                </div>
                                <div class="col-span-3">
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="bg-white border border-slate-200 rounded-lg p-4 shadow-sm text-left">
                                            <div class="text-sm font-semibold mb-2"><i class="ri-python-line mr-1"></i>API / Worker</div>
                                            <span class="text-[0.7em] text-emerald-600 bg-emerald-50 px-2 py-1 rounded">● Monkey Patch</span>
                                        </div>
                                        <div class="bg-white border border-slate-200 rounded-lg p-4 shadow-sm text-left">
                                            <div class="text-sm font-semibold mb-2"><i class="ri-box-3-line mr-1"></i>Plugin Daemon</div>
                                            <span class="text-[0.7em] text-amber-600 bg-amber-50 px-2 py-1 rounded">● Compile Probe</span>
                                        </div>
                                    </div>
                                    <div class="border-t border-slate-200 mt-3 pt-3 flex gap-3 text-[0.7em] text-text-secondary justify-center">
                                        <span class="border border-slate-200 px-3 py-1 rounded">Redis</span>
                                        <span class="border border-slate-200 px-3 py-1 rounded">PostgreSQL</span>
                                        <span class="border border-slate-200 px-3 py-1 rounded">VectorDB</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 5.1 Implementation Code View -->
                <section>
                    <div class="flex h-full items-start gap-[60px]">
                        <div class="flex-1 text-left">
                            <h3>技术内幕：无侵入探针</h3>
                            <p class="text-text-secondary" style="font-size: 0.7em;">
                                面对 Dify 频繁的迭代，我们不能修改源码。
                                方案：<strong>Monkey Patch (Python)</strong> 与 <strong>Compile-time Instrumentation
                                    (Go)</strong>。
                            </p>
                            <div class="outline-card" style="margin-top: 20px;">
                                <h4>接入方案概览</h4>
                                <ul style="font-size: 0.65em; line-height: 1.8; color: var(--text-secondary);">
                                    <li><strong>API / Worker (Python):</strong> 使用 <code
                                            class="text-dify">aliyun-bootstrap</code> 动态劫持 Flask/Celery 入口，注入 Trace 上下文。
                                    </li>
                                    <li><strong>Plugin-Daemon (Go):</strong> 修改 Dockerfile，在 <code
                                            class="text-dify">go build</code> 阶段注入 instgo 工具，自动插桩。</li>
                                    <li><strong>Trace Link:</strong> 在 HTTP Header 中透传 TraceID，串联业务日志与基础设施。</li>
                                </ul>
                            </div>
                        </div>
                        <div class="flex-1 text-left">
                            <!-- Code Editor Window -->
                            <div
                                style="background: #1e1e1e; border-radius: 8px; padding: 20px; font-family: 'Fira Code', monospace; font-size: 0.55em; color: #d4d4d4; box-shadow: 0 15px 40px rgba(0,0,0,0.4); text-align: left; position: relative;">
                                <!-- Window Controls -->
                                <div
                                    style="display: flex; gap: 6px; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px;">
                                    <span
                                        style="width: 10px; height: 10px; border-radius: 50%; background: #ff5f56;"></span>
                                    <span
                                        style="width: 10px; height: 10px; border-radius: 50%; background: #ffbd2e;"></span>
                                    <span
                                        style="width: 10px; height: 10px; border-radius: 50%; background: #27c93f;"></span>
                                    <span style="margin-left: auto; color: #888; font-size: 0.9em;">entrypoint.sh</span>
                                </div>

                                <div style="color: #6a9955; margin-bottom: 5px;"># 1. Python 启动脚本劫持</div>
                                <div><span style="color: #c586c0;">if</span> [ "<span
                                        style="color: #9cdcfe;">$DEBUG</span>" = "<span
                                        style="color: #ce9178;">true</span>" ]; <span
                                        style="color: #c586c0;">then</span></div>
                                <div style="padding-left: 20px;">exec flask run ...</div>
                                <div><span style="color: #c586c0;">else</span></div>
                                <div style="padding-left: 20px; color: #6a9955;"># 注入 aliyun-instrument</div>
                                <div
                                    style="padding-left: 20px; background: rgba(255, 255, 255, 0.05); border-left: 2px solid #569cd6; padding-left: 10px;">
                                    <span style="color: #569cd6;">exec</span> <span
                                        style="color: #dcdcaa;">aliyun-instrument</span> gunicorn \</div>
                                <div style="padding-left: 40px;">--bind ... \</div>
                                <div style="padding-left: 40px;">--workers ... \</div>
                                <div style="padding-left: 40px;">app:app</div>
                                <div><span style="color: #c586c0;">fi</span></div>
                                <br>
                                <div style="height: 1px; background: #333; margin: 15px 0;"></div>

                                <div style="color: #6a9955; margin-bottom: 5px;">// 2. Go Dockerfile 编译插桩</div>
                                <div><span style="color: #569cd6;">RUN</span> wget .../instgo-linux-amd64 -O instgo
                                </div>
                                <div
                                    style="background: rgba(255, 255, 255, 0.05); border-left: 2px solid #d97706; padding-left: 10px;">
                                    <span style="color: #569cd6;">RUN</span> ./instgo go build -o main
                                    cmd/server/main.go</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Section: Python Monkey Patch Deep Dive -->
                <section>
                    <div class="flex h-full items-start gap-[60px]">
                        <div class="flex-1 text-left">
                            <h3>5.1 技术深潜：Python Monkey Patch 原理</h3>
                            <p class="text-text-secondary" style="font-size: 0.7em;">
                                <span style="color: var(--dify-blue);">aliyun-instrument</span> 的核心在于使用
                                <code>wrapt</code> 库在运行时劫持 Dify 关键方法。
                            </p>
                            <div class="outline-card"
                                style="margin-top: 20px; background: linear-gradient(135deg, #fff7ed 0%, #fff 100%); border-color: #fdba74;">
                                <h4 style="color: #d97706;">核心机制拆解</h4>
                                <ul
                                    style="font-size: 0.65em; line-height: 1.8; color: var(--text-secondary); margin-bottom: 0;">
                                    <li><i class="ri-shuffle-line"></i> <strong>动态替换:</strong> 模块加载时，定位目标函数（如
                                        <code>WorkflowRunner.run</code>），替换为 Wrapper。</li>
                                    <li><i class="ri-eye-line"></i> <strong>上下文透明:</strong> <code>wrapt</code>
                                        确保原函数的元数据（如 <code>__name__</code>）保持不变，对上层业务透明。</li>
                                    <li><i class="ri-bug-line"></i> <strong>异常穿透:</strong> 捕获异常记录到 Span
                                        Event，随后原样抛出，不影响业务流。</li>
                                </ul>
                            </div>
                        </div>
                        <div class="flex-1 text-left">
                            <!-- Python Code Window -->
                            <div
                                style="background: #1e1e1e; border-radius: 8px; padding: 20px; font-family: 'Fira Code', monospace; font-size: 0.5em; color: #d4d4d4; box-shadow: 0 15px 40px rgba(0,0,0,0.4); text-align: left; height: 420px; overflow-y: auto;">
                                <div style="color: #6a9955;"># Pseudo-code: Dify Instrumentation Logic</div>
                                <div><span style="color: #c586c0;">import</span> wrapt</div>
                                <div><span style="color: #c586c0;">from</span> opentelemetry <span
                                        style="color: #c586c0;">import</span> trace</div>
                                <br>
                                <div><span style="color: #c586c0;">def</span> <span
                                        style="color: #dcdcaa;">_instrument</span>(self, **kwargs):</div>
                                <div style="padding-left: 20px; color: #6a9955;"># 1. 定位并劫持目标函数</div>
                                <div style="padding-left: 20px;">wrapt.wrap_function_wrapper(</div>
                                <div style="padding-left: 40px;"><span
                                        style="color: #ce9178;">"dify.core.workflow.runner"</span>, <span
                                        style="color: #6a9955;"># Module</span></div>
                                <div style="padding-left: 40px;"><span
                                        style="color: #ce9178;">"WorkflowRunner.run"</span>, <span
                                        style="color: #6a9955;"># Method</span></div>
                                <div style="padding-left: 40px;">self._trace_wrapper <span style="color: #6a9955;">#
                                        Hook</span></div>
                                <div style="padding-left: 20px;">)</div>
                                <br>
                                <div><span style="color: #c586c0;">def</span> <span
                                        style="color: #dcdcaa;">_trace_wrapper</span>(self, wrapped, instance, args,
                                    kwargs):</div>
                                <div style="padding-left: 20px;">tracer = trace.get_tracer(<span
                                        style="color: #ce9178;">"aliyun.dify"</span>)</div>
                                <div style="padding-left: 20px; color: #6a9955;"># 2. 开启 Span</div>
                                <div style="padding-left: 20px;"><span style="color: #c586c0;">with</span>
                                    tracer.start_as_current_span(<span style="color: #ce9178;">"workflow.run"</span>)
                                    <span style="color: #c586c0;">as</span> span:</div>
                                <div style="padding-left: 40px; color: #6a9955;"># 3. 记录输入参数</div>
                                <div style="padding-left: 40px;">span.set_attribute(<span
                                        style="color: #ce9178;">"user_id"</span>, kwargs.get(<span
                                        style="color: #ce9178;">"user_id"</span>))</div>
                                <br>
                                <div style="padding-left: 40px; color: #6a9955;"># 4. 执行原业务逻辑</div>
                                <div style="padding-left: 40px;">result = wrapped(*args, **kwargs)</div>
                                <br>
                                <div style="padding-left: 40px; color: #6a9955;"># 5. 记录结果并返回</div>
                                <div style="padding-left: 40px;"><span style="color: #c586c0;">return</span> result
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h3>5.1 采样与限流策略</h3>
                        <div class="grid grid-cols-3 gap-4 text-[0.8em] text-text-secondary">
                            <div class="bg-bg-card rounded-xl border border-black/5 p-4 glow-card">
                                <div class="text-sm font-semibold text-text-main mb-2">动态采样</div>
                                <p>按 Span 类型设置采样率：LLM 20%，向量检索 50%，关键交易 100%。</p>
                            </div>
                            <div class="bg-bg-card rounded-xl border border-black/5 p-4 glow-card">
                                <div class="text-sm font-semibold text-text-main mb-2">Token 限流</div>
                                <p>结合队列长度与 TPS，动态调节 prompt 长度与并发窗口。</p>
                            </div>
                            <div class="bg-bg-card rounded-xl border border-black/5 p-4 glow-card">
                                <div class="text-sm font-semibold text-text-main mb-2">异常升级</div>
                                <p>捕获错误率>1% 时提升采样到 100%，自动打开调试日志。</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 5.1 Case Study Story -->
                <section data-background-color="#ffffff">
                    <div style="text-align: left; margin-bottom: 30px;">
                        <h3>实战案例：定位“幽灵”报错</h3>
                        <p class="text-text-secondary" style="font-size: 0.8em;">场景：前端显示正常，RAG 检索结果却为空，Dify 业务日志无报错。</p>
                    </div>

                    <div class="grid grid-cols-3 gap-[25px]">
                        <!-- Step 1: Symptom -->
                        <div class="relative overflow-hidden rounded-lg border border-[#fee2e2] bg-[#fef2f2] p-5 text-left">
                            <div class="absolute top-0 right-0 bg-[#dc2626] text-white text-[0.4em] px-2 py-0.5 rounded-bl-lg">🛑</div>
                            <div class="text-[#dc2626] font-bold text-[0.8em] mb-2.5">
                                <i class="ri-alarm-warning-line"></i> 发现异常
                            </div>
                            <p class="text-[0.65em] mb-4">查看 Workflow Trace，发现 Retriever 节点耗时极短，且 Output 为空字符串。</p>
                            <div class="bg-white p-3 rounded-md mt-4 border border-dashed border-[#dc2626] text-center">
                                <code class="text-[0.7em] text-[#dc2626]">output: ""</code>
                            </div>
                        </div>

                        <!-- Step 2: Link -->
                        <div class="relative overflow-hidden rounded-lg border border-[#dbeafe] bg-[#eff6ff] p-5 text-left">
                            <div class="absolute top-0 right-0 bg-dify text-white text-[0.4em] px-2 py-0.5 rounded-bl-lg">🔗</div>
                            <div class="text-dify font-bold text-[0.8em] mb-2.5">
                                <i class="ri-link-m"></i> Trace Link
                            </div>
                            <p class="text-[0.65em]">点击 Span 详情中的 "Infrastructure Link" 按钮，携带 Trace ID 跳转至 SLS/Jaeger。
                            </p>
                            <div class="text-center mt-5">
                                <button
                                    class="bg-dify text-white border-0 px-4 py-2 rounded text-[0.6em] shadow-[0_4px_6px_rgba(0,51,255,0.2)] cursor-pointer">View
                                    Infra Trace →</button>
                            </div>
                        </div>

                        <!-- Step 3: Root Cause -->
                        <div class="relative overflow-hidden rounded-lg border border-[#d1fae5] bg-[#ecfdf5] p-5 text-left">
                            <div class="absolute top-0 right-0 bg-[#059669] text-white text-[0.4em] px-2 py-0.5 rounded-bl-lg">🐞</div>
                            <div class="text-[#059669] font-bold text-[0.8em] mb-2.5">
                                <i class="ri-bug-2-line"></i> 根因定位
                            </div>
                            <p class="text-[0.65em]">在 Worker 的底层 Span 中捕获到未抛出的异常堆栈，发现向量库版本不兼容。</p>
                            <div class="bg-white p-3 rounded-md mt-4 border border-dashed border-[#059669] text-left">
                                <code
                                    class="text-[0.5em] text-[#059669] block break-words font-[var(--font-mono)]">ValueError: Weaviate version 1.19.0 not supported...</code>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 5.2 DB Support (Expanded) -->
                <section>
                    <div class="flex h-full items-start gap-[60px]">
                        <div class="flex-1 text-left">
                            <h3>5.2 数据库适配：架构解耦 (Schema)</h3>
                            <ul class="text-text-secondary text-[0.7em] leading-[1.6] mb-5">
                                <li><strong>DB_TYPE 支持:</strong> <code class="text-dify">DatabaseConfig</code> 新增类型选择，支持
                                    PostgreSQL, MySQL, OceanBase。</li>
                                <li><strong>动态引擎:</strong> SQLAlchemy URI 与 Engine Options 根据类型动态调整。</li>
                                <li><strong>配置更新:</strong> 移除 OceanBase 向量配置，统一管理。</li>
                            </ul>
                            <div class="outline-card" style="padding: 15px;">
                                <h4 style="font-size: 0.7em;">配置示例 (.env)</h4>
                                <div style="font-family: 'Fira Code', monospace; font-size: 0.5em; color: #4b5563;">
                                    <div># Select Database Type</div>
                                    <div>DB_TYPE=<span style="color: var(--dify-blue);">mysql</span></div>
                                    <div style="margin-top: 5px;"># MySQL Configuration</div>
                                    <div>MYSQL_HOST=localhost</div>
                                    <div>MYSQL_PORT=3306</div>
                                    <div>MYSQL_USER=dify_user</div>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1 text-left">
                            <!-- Diagram for DB Architecture -->
                            <div
                                style="background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.05);">
                                <div
                                    style="background: #eff6ff; padding: 10px; border-radius: 8px; display: inline-block; color: var(--dify-blue); font-weight: 700; font-size: 0.8em; width: 80%;">
                                    Dify API / Worker</div>
                                <div style="height: 30px; border-left: 2px dashed #cbd5e1; margin: 0 auto;"></div>
                                <div
                                    style="background: #f3f4f6; padding: 8px; border-radius: 20px; font-size: 0.6em; color: var(--text-secondary); display: inline-block; border: 1px solid #e5e7eb;">
                                    SQLAlchemy Engine Factory</div>
                                <div style="height: 30px; border-left: 2px dashed #cbd5e1; margin: 0 auto;"></div>
                                <div style="display: flex; justify-content: space-around; gap: 10px;">
                                    <div
                                        style="border: 2px solid #0064a5; border-radius: 8px; padding: 10px; width: 80px;">
                                        <i class="ri-database-2-fill" style="color: #0064a5; font-size: 1.5em;"></i>
                                        <div style="font-size: 0.5em; font-weight: 600;">Postgres</div>
                                    </div>
                                    <div
                                        style="border: 2px solid #e48e00; border-radius: 8px; padding: 10px; width: 80px;">
                                        <i class="ri-database-2-line" style="color: #e48e00; font-size: 1.5em;"></i>
                                        <div style="font-size: 0.5em; font-weight: 600;">MySQL</div>
                                    </div>
                                    <div
                                        style="border: 2px solid #00a1ff; border-radius: 8px; padding: 10px; width: 80px;">
                                        <i class="ri-cloud-line" style="color: #00a1ff; font-size: 1.5em;"></i>
                                        <div style="font-size: 0.5em; font-weight: 600;">OceanBase</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left space-y-6">
                        <h3>5.2 性能指标看板</h3>
                        <div class="grid grid-cols-3 gap-4 text-[0.85em] text-text-secondary">
                            <div class="bg-white rounded-xl border border-black/5 p-4 shadow-sm text-center">
                                <div class="text-2xl font-bold text-dify">410 ms</div>
                                <div class="text-xs uppercase tracking-wide">p95 延迟</div>
                                <div class="h-1 bg-gradient-to-r from-dify to-blue-200 rounded-full mt-2 animate-pulse"></div>
                            </div>
                            <div class="bg-white rounded-xl border border-black/5 p-4 shadow-sm text-center">
                                <div class="text-2xl font-bold text-dify">0.0021</div>
                                <div class="text-xs uppercase tracking-wide">$/Request</div>
                                <div class="text-xs text-text-secondary mt-1">含 RAG 检索 & LLM</div>
                            </div>
                            <div class="bg-white rounded-xl border border-black/5 p-4 shadow-sm text-center">
                                <div class="text-2xl font-bold text-dify">99.96%</div>
                                <div class="text-xs uppercase tracking-wide">成功率</div>
                                <div class="text-xs text-text-secondary mt-1">过去 7d</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-[0.75em] text-text-secondary">
                            <div class="bg-bg-card rounded-lg border border-black/5 p-4">
                                <div class="font-semibold text-text-main mb-2">热点 Span</div>
                                <ul class="space-y-1">
                                    <li>workflow.run → 35%</li>
                                    <li>retriever.query → 22%</li>
                                    <li>llm.call → 18%</li>
                                </ul>
                            </div>
                            <div class="bg-bg-card rounded-lg border border-black/5 p-4">
                                <div class="font-semibold text-text-main mb-2">优化动作</div>
                                <ul class="space-y-1">
                                    <li>分片向量库，减少 tail latency</li>
                                    <li>Prompt 缓存命中率提升 12%</li>
                                    <li>异步回调降低 API 阻塞</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 5.3 CI/CD (Migration Versions) -->
                <section data-background-color="#ffffff">
                    <div class="flex h-full items-start gap-[60px]">
                        <div class="flex-1 text-left">
                            <h3>5.3 质量保障：差异化 CI/CD</h3>
                            <p class="text-text-secondary text-[0.8em]">
                                为了保障 Schema 在不同数据库方言下的兼容性，引入了针对 MySQL 的独立迁移测试。
                            </p>
                            <ul class="text-text-secondary text-[0.7em] leading-[1.8] mt-5 space-y-2">
                                <li><i class="ri-git-branch-line"></i> <strong>GitHub Actions 改造:</strong> 区分 Postgres 与
                                    MySQL Service。</li>
                                <li><i class="ri-test-tube-line"></i> <strong>Migration Test Job:</strong> 针对 MySQL
                                    运行完整的 Alembic 迁移脚本，确保无语法错误。</li>
                                <li><i class="ri-shield-check-line"></i> <strong>兼容性红线:</strong> 任何 Schema 变更必须同时通过双库测试。
                                </li>
                            </ul>
                        </div>
                        <div class="flex-1 text-left">
                            <!-- Diagram for CI Pipeline -->
                            <div style="font-size: 0.6em; font-family: 'Fira Code', monospace;">
                                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                    <div style="background: #e2e8f0; padding: 8px 15px; border-radius: 4px;">Pull
                                        Request</div>
                                    <div style="flex: 1; height: 2px; background: #cbd5e1; margin: 0 10px;"></div>
                                    <div
                                        style="background: var(--dify-blue); color: #fff; padding: 8px 15px; border-radius: 4px;">
                                        Matrix Strategy</div>
                                </div>

                                <div style="margin-left: 20px; border-left: 2px solid #cbd5e1; padding-left: 20px;">
                                    <div
                                        style="background: #ecfdf5; border: 1px solid #059669; color: #059669; padding: 10px; border-radius: 6px; margin-bottom: 10px; display: flex; justify-content: space-between;">
                                        <span>Job: test-api (Postgres)</span>
                                        <i class="ri-checkbox-circle-fill"></i>
                                    </div>
                                    <div
                                        style="background: #fffbeb; border: 1px solid #d97706; color: #d97706; padding: 10px; border-radius: 6px; display: flex; justify-content: space-between;">
                                        <span>Job: migration-test (MySQL)</span>
                                        <i class="ri-loader-4-line"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 5.4 Code Refactoring (A little SQL) -->
                <section>
                    <div style="text-align: left; margin-bottom: 20px;">
                        <h3>5.4 代码重构：SQL 兼容性抽象</h3>
                        <p class="text-text-secondary" style="font-size: 0.8em;">用 Python Helper 与 ORM 方法替代方言特定的 Raw
                            SQL。</p>
                    </div>

                    <div class="grid grid-cols-2 gap-[30px]">
                        <!-- Date Time Helper -->
                        <div class="bg-bg-card p-5 rounded-lg text-left">
                            <h4 class="text-[0.8em] mb-2.5">Portable Date Functions</h4>
                            <p class="text-[0.6em] text-text-secondary mb-4">
                                <code class="text-dify">convert_datetime_to_date</code> 封装了不同数据库的日期截断逻辑 (Postgres
                                <code>date_trunc</code> vs MySQL <code>date_format</code>)。
                            </p>
                            <div
                                class="bg-[#1e1e1e] p-2.5 rounded-md text-[#d4d4d4] text-[0.45em] font-[var(--font-mono)] text-left">
                                <div style="color: #6a9955;"># api/controllers/console/app/statistic.py</div>
                                <div><span style="color: #c586c0;">def</span> convert_datetime_to_date(column):</div>
                                <div style="padding-left: 10px;"><span style="color: #c586c0;">if</span> db.engine.name
                                    == <span style="color: #ce9178;">'postgresql'</span>:</div>
                                <div style="padding-left: 20px;"><span style="color: #c586c0;">return</span>
                                    func.date_trunc(<span style="color: #ce9178;">'day'</span>, column)</div>
                                <div style="padding-left: 10px;"><span style="color: #c586c0;">return</span>
                                    func.date(column)</div>
                            </div>
                        </div>

                        <!-- JSON Filter -->
                        <div class="bg-bg-card p-5 rounded-lg text-left">
                            <h4 class="text-[0.8em] mb-2.5">Metadata Filter Standardization</h4>
                            <p class="text-[0.6em] text-text-secondary mb-4">
                                <code class="text-dify">dataset_retrieval.py</code> 移除 Raw SQL 片段，使用 SQLAlchemy JSON
                                方法增强类型安全。
                            </p>
                            <div
                                class="bg-[#1e1e1e] p-2.5 rounded-md text-[#d4d4d4] text-[0.45em] font-[var(--font-mono)] text-left">
                                <div style="color: #d16969;">- sql += f"meta->>'{key}' = '{value}'"</div>
                                <div style="color: #6a9955;">+ filter_conditions.append(</div>
                                <div style="color: #6a9955; padding-left: 10px;">+ Dataset.meta[key].as_string() ==
                                    value</div>
                                <div style="color: #6a9955;">+ )</div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- New Section 5.5: Cost Analysis -->
                <section data-background-color="#ffffff">
                    <div class="max-w-5xl mx-auto text-left">
                        <h3>5.5 成本分析与优化</h3>
                        <p class="text-text-secondary text-[0.8em] mb-8">精细化运营：知道每一分钱花在哪里。</p>
                        
                        <div class="flex items-center gap-10">
                            <!-- Pie Chart Mockup -->
                            <div class="w-64 h-64 rounded-full relative" style="background: conic-gradient(var(--dify-blue) 0% 60%, #eab308 60% 85%, #ef4444 85% 100%)">
                                <div class="absolute inset-4 bg-white rounded-full flex flex-col items-center justify-center">
                                    <span class="text-xs text-gray-500">Total Cost</span>
                                    <span class="text-2xl font-bold text-dify">$4,281</span>
                                </div>
                            </div>
                            
                            <!-- Legend -->
                            <div class="flex-1 grid grid-cols-2 gap-4">
                                <div class="p-4 rounded-xl border border-gray-100 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="w-3 h-3 bg-dify rounded-full"></span>
                                        <span class="font-bold text-sm">LLM Inference</span>
                                    </div>
                                    <div class="text-xs text-gray-500">GPT-4, Claude 3 (60%)</div>
                                    <div class="text-lg font-mono mt-1">$2,568</div>
                                </div>
                                <div class="p-4 rounded-xl border border-gray-100 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="w-3 h-3 bg-yellow-500 rounded-full"></span>
                                        <span class="font-bold text-sm">Vector DB</span>
                                    </div>
                                    <div class="text-xs text-gray-500">Storage & Indexing (25%)</div>
                                    <div class="text-lg font-mono mt-1">$1,070</div>
                                </div>
                                <div class="p-4 rounded-xl border border-gray-100 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                                        <span class="font-bold text-sm">Embedding</span>
                                    </div>
                                    <div class="text-xs text-gray-500">Text-to-Vector (15%)</div>
                                    <div class="text-lg font-mono mt-1">$643</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Section 6: 总结 -->
            <section data-background-color="#ffffff">
                <div class="max-w-4xl mx-auto text-left space-y-6">
                    <h2 class="text-3xl md:text-4xl font-bold tracking-tight">总结 · LLM 应用开发的进化路径</h2>
                    <p class="text-text-secondary text-[0.95em] leading-[1.75]">
                        以统一编排为核心，叠加工程护栏、生态扩展与事件驱动，构建可观测、可演进的生产级 AI 应用。</p>
                    <div class="roadmap-horizontal">
                        <div class="roadmap-h-step">
                            <div class="roadmap-card bg-bg-card p-4 rounded-xl border border-black/5 flex flex-col gap-1">
                                <div class="text-sm font-semibold text-text-main">阶段 1 · 范式升级</div>
                                <div class="text-text-secondary text-[0.85em]">低代码编排 + Pro-Code 深逻辑，压缩从想法到上线。</div>
                                <span class="text-xs text-dify bg-dify-light px-2 py-1 rounded-full self-start">Week 1</span>
                            </div>
                        </div>
                        <div class="roadmap-h-step">
                            <div class="roadmap-card bg-white p-4 rounded-xl border border-black/5 shadow-sm flex flex-col gap-1">
                                <div class="text-sm font-semibold text-text-main">阶段 2 · 工程护栏</div>
                                <div class="text-text-secondary text-[0.85em]">重试、分支、配额、可观测性与治理策略，守护可靠性。</div>
                                <span class="text-xs text-emerald-700 bg-emerald-50 px-2 py-1 rounded-full self-start">Week 2</span>
                            </div>
                        </div>
                        <div class="roadmap-h-step">
                            <div class="roadmap-card bg-bg-card p-4 rounded-xl border border-black/5 flex flex-col gap-1">
                                <div class="text-sm font-semibold text-text-main">阶段 3 · 生态扩展 & 事件驱动</div>
                                <div class="text-text-secondary text-[0.85em]">Marketplace / Plugin / Trigger 打通外部能力，形成资产库。</div>
                                <span class="text-xs text-orange-700 bg-orange-50 px-2 py-1 rounded-full self-start">Week 3</span>
                            </div>
                        </div>
                        <div class="roadmap-h-step">
                            <div class="roadmap-card bg-white p-4 rounded-xl border border-black/5 shadow-sm flex flex-col gap-1">
                                <div class="text-sm font-semibold text-text-main">阶段 4 · 数据透明与演进</div>
                                <div class="text-text-secondary text-[0.85em]">OTEL 全链路 + 多库抽象，持续优化性能与成本。</div>
                                <span class="text-xs text-dify bg-dify-light px-2 py-1 rounded-full self-start">持续</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 7: Thank You -->
            <section data-background-color="#f9fafb">
                <div class="max-w-5xl mx-auto flex flex-col md:flex-row gap-8 items-center">
                    <div class="flex-1 bg-white rounded-xl border border-black/5 px-10 py-12 shadow-sm">
                        <h2 class="text-3xl font-bold mb-4 text-dify">Thank You</h2>
                        <div class="text-[1.05em] mb-3 font-semibold text-text-secondary">
                            <span class="text-dify">Call for Action：</span>
                            欢迎提交 PR，贡献插件、案例与最佳实践，共建 Dify 生态。
                        </div>
                        <div class="bg-bg-card px-5 py-4 rounded-xl border border-black/5 flex items-center gap-3 text-[0.95em] mt-6">
                            <i class="ri-mail-line text-dify text-[1.4em]"></i>
                            <div>
                                <div class="text-text-secondary">banana@dify.ai</div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-1 grid grid-cols-2 gap-7 justify-items-center">
                        <div class="bg-bg-card p-6 rounded-xl border border-black/5 text-center w-full max-w-[260px]">
                            <img src="../assets/xiaohongshu.png" alt="小红书 QR Code"
                                class="w-[180px] h-[180px] object-cover rounded-lg border border-black/5 bg-white mx-auto">
                            <div class="mt-3 text-[0.8em] font-semibold text-text-secondary tracking-[0.02em]">小红书</div>
                        </div>
                        <div class="bg-bg-card p-6 rounded-xl border border-black/5 text-center w-full max-w-[260px]">
                            <img src="../assets/bilibili.png" alt="哔哩哔哩 QR Code"
                                class="w-[180px] h-[180px] object-cover rounded-lg border border-black/5 bg-white mx-auto">
                            <div class="mt-3 text-[0.8em] font-semibold text-text-secondary tracking-[0.02em]">哔哩哔哩</div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/plugin/highlight/highlight.js"></script>

    <script>initReveal();</script>
</body>

</html>
